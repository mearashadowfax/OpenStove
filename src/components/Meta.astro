---
interface Props {
  url?: string;
  title?: string;
  description?: string;
  image?: string;
  type?: "website" | "article";
  robots?: string;
  recipeData?: {
    author?: string;
    pubDate?: Date;
    cookingTime?: number;
    servings?: number;
    ingredients?: Array<{
      title?: string;
      items: Array<{
        quantity?: string;
        name: string;
      }>;
    }>;
    steps?: Array<{
      title?: string;
      actions: string[];
    }>;
  };
}

const {
  url = Astro.url.href,
  title = "OpenStove",
  description = "Explore OpenStove, a curated collection of ad-free, community-shared recipes. Connect with cooking enthusiasts and contribute to our GitHub-hosted culinary repository. No fees, just the joy of cooking and sharing.",
  image = `${Astro.site}/social-image.png`,
  type = "website",
  robots = "index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1",
  recipeData,
} = Astro.props;

const canonicalUrl = url;
const pageTitle = title;
const pageDescription = description;
const pageImage = image;
const pageType = type;
---

<!-- Canonical URL -->
<link rel="canonical" href={canonicalUrl} />

<!-- Robots Meta Tag -->
<meta name="robots" content={robots} />
<meta name="googlebot" content={robots} />

<script
  type="application/ld+json"
  set:html={JSON.stringify(
    (() => {
      if (recipeData && type === "article") {
        const recipeSchema: Record<string, any> = {
          "@context": "https://schema.org",
          "@type": "Recipe",
          name: pageTitle.replace(" | OpenStove", ""),
          description: pageDescription,
          image: pageImage,
          url: canonicalUrl,
          author: {
            "@type": "Person",
            name: recipeData.author || "Anonymous",
          },
          publisher: {
            "@type": "Organization",
            name: "OpenStove",
            url: "https://openstove.org",
          },
          mainEntityOfPage: {
            "@type": "WebPage",
            "@id": canonicalUrl,
          },
        };

        if (recipeData.pubDate) {
          recipeSchema.datePublished = recipeData.pubDate.toISOString();
        }
        if (recipeData.cookingTime) {
          recipeSchema.prepTime = `PT${recipeData.cookingTime}M`;
        }
        if (recipeData.servings) {
          recipeSchema.recipeYield = `${recipeData.servings} servings`;
        }
        if (recipeData.ingredients && recipeData.ingredients.length > 0) {
          recipeSchema.recipeIngredient = recipeData.ingredients.flatMap(
            (group) =>
              group.items.map(
                (item) =>
                  `${item.quantity ? item.quantity + " " : ""}${item.name}`,
              ),
          );
        }
        if (recipeData.steps && recipeData.steps.length > 0) {
          recipeSchema.recipeInstructions = recipeData.steps.map(
            (step, index) => ({
              "@type": "HowToStep",
              position: index + 1,
              name: step.title || `Step ${index + 1}`,
              text: step.actions.join(" "),
            }),
          );
        }

        return recipeSchema;
      }

      return {
        "@context": "https://schema.org",
        "@type": pageType === "article" ? "Article" : "WebPage",
        url: canonicalUrl,
        name: pageTitle,
        headline: pageTitle,
        alternateName:
          "OpenStove â€” A Curated Collection of Community-Crafted Recipes",
        description: pageDescription,
        image: pageImage,
        isPartOf: {
          "@type": "WebSite",
          url: "https://openstove.org",
          name: "OpenStove",
          description:
            "Explore OpenStove, a curated collection of ad-free, community-shared recipes. Connect with cooking enthusiasts and contribute to our GitHub-hosted culinary repository.",
        },
        inLanguage: "en-US",
      };
    })(),
  )}
/>

<meta content={pageDescription} name="description" />
<meta content="Emil Gulamov" name="web_author" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0"
/>
<meta http-equiv="X-UA-Compatible" content="ie=edge" />

<!-- Facebook Meta Tags -->
<meta content="en_US" property="og:locale" />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:type" content={pageType} />
<meta property="og:title" content={pageTitle} />
<meta content="OpenStove" property="og:site_name" />
<meta property="og:description" content={pageDescription} />
<meta property="og:image" content={pageImage} />
<meta content="1200" property="og:image:width" />
<meta content="600" property="og:image:height" />
<meta content="image/png" property="og:image:type" />

<!-- Twitter Meta Tags -->
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:domain" content="openstove.org" />
<meta property="twitter:url" content={canonicalUrl} />
<meta name="twitter:title" content={pageTitle} />
<meta name="twitter:description" content={pageDescription} />
<meta name="twitter:image" content={pageImage} />

<link href="/manifest.webmanifest" rel="manifest" />
<link rel="sitemap" href="/sitemap-index.xml" />

<link href="/favicon.ico" rel="icon" sizes="any" type="image/x-icon" />
<link href="/icon.svg" rel="icon" type="image/svg+xml" sizes="any" />
<meta name="mobile-web-app-capable" content="yes" />
<link href="/apple-touch-icon.png" rel="apple-touch-icon" />
<link href="/apple-touch-icon.png" rel="shortcut icon" />
<meta name="theme-color" content="#FFEDD5" />
